[server]
listen_addr = "0.0.0.0:3389"
max_connections = 5
session_timeout = 0
use_portals = true

[security]
cert_path = "/home/greg/wayland-build/wrd-server-specs/certs/test-cert.pem"
key_path = "/home/greg/wayland-build/wrd-server-specs/certs/test-key.pem"
enable_nla = false
auth_method = "none"
require_tls_13 = false

[video]
encoder = "auto"
vaapi_device = "/dev/dri/renderD128"
target_fps = 30
bitrate = 4000
damage_tracking = true
cursor_mode = "metadata"

[video_pipeline.processor]
target_fps = 30
max_queue_depth = 30
adaptive_quality = true
damage_threshold = 0.05
drop_on_full_queue = true
enable_metrics = true

[video_pipeline.dispatcher]
channel_size = 30
priority_dispatch = true
max_frame_age_ms = 150
enable_backpressure = true
high_water_mark = 0.8
low_water_mark = 0.5
load_balancing = true

[video_pipeline.converter]
buffer_pool_size = 8
enable_simd = true
damage_threshold = 0.75
enable_statistics = true

[input]
use_libei = true
keyboard_layout = "auto"
enable_touch = false

[clipboard]
enabled = true
max_size = 10485760
rate_limit_ms = 200
allowed_types = []

[multimon]
enabled = true
max_monitors = 4

[performance]
encoder_threads = 0
network_threads = 0
buffer_pool_size = 16
zero_copy = true

[performance.adaptive_fps]
enabled = true
min_fps = 5
max_fps = 30
high_activity_threshold = 0.30
medium_activity_threshold = 0.10
low_activity_threshold = 0.01

[performance.latency]
mode = "balanced"
interactive_max_delay_ms = 16
balanced_max_delay_ms = 33
quality_max_delay_ms = 100
balanced_damage_threshold = 0.15
quality_damage_threshold = 0.05

[logging]
level = "info"
metrics = true

# ============================================================================
# EGFX Configuration - Graphics Pipeline Extension (H.264 Video)
# ============================================================================
[egfx]
enabled = true
h264_level = "auto"
h264_bitrate = 10000
zgfx_compression = "never"
max_frames_in_flight = 3
frame_ack_timeout = 5000
codec = "avc420"
# QP settings for H.264 quality (lower = better quality)
qp_min = 10
qp_max = 25
qp_default = 18
# AVC444 settings - MUST be in [egfx] section
# CRITICAL: aux_omission MUST be true for P-frames to work with single encoder!
# See docs/AVC444-AUX-OMISSION-CRITICAL-FINDING.md for full explanation
avc444_enabled = true
avc444_enable_aux_omission = true
avc444_max_aux_interval = 30
avc444_aux_change_threshold = 0.05
avc444_force_aux_idr_on_return = false

[damage_tracking]
enabled = true
method = "diff"
tile_size = 64
diff_threshold = 0.05
merge_distance = 32

[hardware_encoding]
enabled = false
vaapi_device = "/dev/dri/renderD128"
enable_dmabuf_zerocopy = true
fallback_to_software = true
quality_preset = "balanced"

[display]
allow_resize = true
allowed_resolutions = []
dpi_aware = false
allow_rotation = false

[advanced_video]
enable_frame_skip = true
scene_change_threshold = 0.3
intra_refresh_interval = 120
enable_adaptive_quality = false
